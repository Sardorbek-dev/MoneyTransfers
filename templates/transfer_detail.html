{% extends 'base.html' %}

{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="container">
  <h1 class="text-center my-5">Transfer bo'yicha batafsil ma'lumot</h1>
  <div class="row">
    <div class="col-12">
        <div class="ui items">
          <div class="item">
             {% if transfer.location != 'GER' %}
                  <div class="image">
                     <img src="{% static '/assets/img/ger_uzb.png' %}" alt="{{ transfer.title }}">
                  </div>
              {% else %}
                  <div class="image">
                      <img src="{% static '/assets/img/uzb_ger.png' %}" alt="{{ transfer.title }}">
                  </div>
              {% endif %}
            <div class="middle aligned content">
              <div class="header">
                {{ transfer.title }}
              </div>
              <div class="description">
                <h4>{{ object.description | safe }}</h4>
              </div>
                <div class="meta">
                    <a>Author: {{ transfer.author | title }} - {{ transfer.date }}</a>
                </div>
              <div class="extra">
                  <div class="ui label">{{ transfer.price }}</div>
                  {% if transfer.location != 'GER' %}
                      <div class="ui label"><i class="globe icon"></i>
                         <i class="uz flag"></i>
                      </div>
                  {% else %}
                  <div class="ui label"><i class="globe icon"></i>
                         <i class="de flag"></i>
                  </div>
                 {% endif %}

                  {% if transfer.moneyCurrency == 'dollar' %}
                      <div class="ui label">
                         <i class="dollar sign icon"></i>
                      </div>
                  {% elif transfer.moneyCurrency == 'euro' %}
                      <div class="ui label">
                         <i class="euro sign icon"></i>
                      </div>
                  {% elif transfer.moneyCurrency == 'som' %}
                      <div class="ui label">
                         <i class="money bill alternate icon"></i>
                      </div>
                  {% elif transfer.moneyCurrency == 'euroordollar' %}
                      <div class="ui label">
                         <i class="euro sign icon"></i>
                         <i class="dollar sign icon"></i>
                      </div>
                  {% elif transfer.moneyCurrency == 'euroorsom' %}
                      <div class="ui label">
                         <i class="euro sign icon"></i>
                         <i class="money bill alternate icon"></i>
                      </div>
                  {% else %}
                      <div class="ui label">
                         <i class="money bill alternate icon"></i>
                          <i class="dollar sign icon"></i>
                      </div>
                 {% endif %}

                  <span>
                      <i class="map pin icon"></i> LOCATION:
                  </span>
                    {{ transfer.location }}

                   <form action="{% url 'like_transfer' transfer.pk %}" method="post">{% csrf_token %}
                        {% if user.is_authenticated %}
                            {% if liked %}
                                <button type="submit" name="transfer_id" value="{{ object.id }}" class="ui red button likeButton">
                                    <i class="thumbs down outline icon"></i>
                                </button>
                            {% else %}
                                <button type="submit" name="transfer_id" value="{{ transfer.id }}" class="ui green button">
                                    <p class="item">
                                        <i class="thumbs up outline icon"></i>
                                    </p>
                                </button>
                            {% endif %}
                        {% else %}
                          Login to like
                        {% endif %}

                        <span>Liked: {{ object.total_likes  }} {{ liked  }}</span>
                    </form>
                   <form action="{% url 'reputation_transfer' transfer.pk %}" method="post">{% csrf_token %}
                        {% if user.is_authenticated %}
                            {% if reputation %}
                                <button type="submit" name="transfer_id" value="{{ transfer.id }}" class="ui red button reputationButton">
                                    <i class="thumbs down outline icon"></i>
                                </button>
                            {% else %}
                                <button type="submit" name="transfer_id" value="{{ transfer.id }}" class="ui green button">
                                    <p class="item">
                                        <i class="thumbs up outline icon"></i>
                                    </p>
                                </button>
                            {% endif %}
                        {% else %}
                          Login to give reputation
                        {% endif %}

                        <span> Reputation: {{ object.total_reputations }}</span>
                    </form>

                  {% if user.is_authenticated %}
                      <div class="ui right floated button">
                          Bog'lanish
                      </div>
                  {% else %}
                      <div class="ui right floated button red">
                          <a href="{% url 'login' %}">Login</a>
                      </div>
                      <div class="ui right floated button">
                          Bog'lanish uchun röyhatdan öting
                      </div>
                  {% endif %}
              </div>
            </div>
          </div>
        </div>
        {% if user.id == transfer.author.id %}
            <div class="row text-center pb-3">
                <div class="col-12">
                    <button class="ui yellow button"><a class="item" href="{% url 'transfer_edit' transfer.pk %}">Tahrirlash</a></button>
                    <button class="ui red button"><a class="item" href="{% url 'transfer_delete' transfer.pk %}">O'chirish</a></button>
                    <button class="ui green button"><a class="item text-white" href="{% url 'transfer_list' %}">Barcha Transferlar</a></button>
                </div>
            </div>
        {% endif %}
        <br/>
    </div>
  </div>

<!--    comments section begin-->

    <div class="ui threaded comments">
        <h3 class="ui dividing header">Comments {{ transfer.page_obj }}</h3>
        {% if not object.transfer_comments.all %}
            NO comments yet.. <a href="#">Add one </a>
        {% else %}
        <!--comments-->

            {% for comment in object.transfer_comments.all %}
                {% if comment.reply.id %}
                {% else %}
                    <div class="comment">
                        <a class="avatar" style="height: 3rem">
                            <img src="{% static '' %}" alt="{{page_user.username}}" class="profileImageShow" id="{{comment.author.profile.user_image}}">
                        </a>
                        <div class="content">
                            <a class="author" href="{% url 'user_profile' comment.author.profile.pk %}">{{ comment.author }}</a>
                            <div class="metadata">
                                <span class="date">{{ comment.date }}</span>
                            </div>
                            <div class="text">
                                {{ comment.transfer_comment }}
                            </div>
                            <div class="actions">
                                <a class="reply">Reply</a>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!--show all comments end -->
                <!--transfer_comment-->
                    {% if comment.reply.id %}
                    {% else%}
                        <div class="comment">

                            <!--comment with replies-->

                            <!--replies-->
                            <div class="comments">
                                {% for reply in comment.transfer_replies.all %}
                                    <div class="comment">
                                        <a class="avatar" style="height: 3rem">
                                            <img src="{% static '' %}" class="profileImageShowReply" id="{{reply.author.profile.user_image}}">
                                        </a>
                                        <div class="content">
                                            <a class="author" href="{% url 'user_profile' reply.author.profile.pk %}">{{ reply.author }}</a>
                                            <div class="metadata">
                                                <span class="date">{{ reply.date }}</span>
                                            </div>
                                            <div class="text">
                                                {{ reply.transfer_comment }}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}

                                <!--add replies beginn -->
                                {% if transfer_comment.reply.id %}

                                {% else %}
                                    {% if user.is_authenticated %}
                                        {% if user.profile.id %}
                                            <div class="action ui accordion" style="text-align: right;">
                                                <a class="reply title">Reply <i class="reply icon"></i></a>
                                                <div class="content">
                                                    <form class="ui reply form" method="post" action="{% url 'transfer_detail_comment' object.pk %}">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                                        <div class="field">
                                                            {{ form|crispy }}
                                                        </div>
                                                        <input type="submit" value="Reply" name="comment_reply" class="ui green button mt-3">
                                                    </form>
                                                </div>
                                            </div>
                                        {% else %}
                                            <p>Please, create a profile to add some comments</p>
                                            <div class="item">
                                                <a class="ui inverted primary button" href="{% url 'create_profile_page' %}">Create a profile</a>
                                            </div>
                                        {% endif %}
                                    {% else %}
                                        <p>Please, Login to add some comments</p>
                                        <div class="item">
                                            <a class="ui inverted primary button" href="{% url 'login' %}">Login</a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                                <!--add replies end -->
                            </div>
                        </div>
                    {% endif %}
            {% endfor %}
        {% endif %}
        <!-- comment end -->
        Leave Comments ()

        {% if user.is_authenticated %}
            {% if user.profile.id %}
                  <form class="ui reply form" method="post" action="{% url 'transfer_detail_comment' object.pk %}">
                        {% csrf_token %}
                        <div class="field">
                            {{ form|crispy }}
                        </div>
                        <button name="comment_add" value="{{ object.id }}"  class="ui red button mt-3" type="submit">Send comment</button>
                    </form>
            {% else %}
                <h1>Please, create a profile page to add some comments </h1>
                <div class="item">
                    <a class="ui inverted secondary button" href="{% url 'create_profile_page' %}">Create Profile</a>
                </div>
            {% endif %}

        <!--add comments end -->

        {% else %}
            <br>
            <p class="mt-2">
                Please, Sign up and create a profile to add a comment or login
            </p>
            <div class="item">
                <a class="ui inverted green button mb-4" href="{% url 'login' %}">Login</a>
                <a class="ui inverted red button mb-4" href="{% url 'signup' %}">Signup</a>
            </div>
        {% endif %}

               <!--Pagination-->
<!--        <div class="container my-5">-->
<!--            <div class="row text-center">-->
<!--                 <div class="ui large horizontal divided list">-->
<!--                     {% if page_obj.has_previous %}-->
<!--                         <div class="item">-->
<!--                           <div class="content">-->
<!--                               <a href="?page=1" class="header">&laquo; first</a>-->
<!--                           </div>-->
<!--                         </div>-->
<!--                         <div class="item">-->
<!--                           <div class="content">-->
<!--                               <a href="?page={{ page_obj.previous_page_number }}" class="header">previous</a>-->
<!--                           </div>-->
<!--                         </div>-->
<!--                     {% endif %}-->

<!--                    <div class="item">-->
<!--                       <div class="content">-->
<!--                           <div class="header">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</div>-->
<!--                       </div>-->
<!--                    </div>-->
<!--                     {% if page_obj.has_next %}-->
<!--                        <div class="item">-->
<!--                           <div class="content">-->
<!--                                <a href="?page={{ page_obj.next_page_number }}" class="header">next</a>-->
<!--                           </div>-->
<!--                        </div>-->
<!--                         <div class="item">-->
<!--                            <div class="content">-->
<!--                                <a href="?page={{ page_obj.paginator.num_pages }}" class="header">last &raquo;</a>-->
<!--                           </div>-->
<!--                         </div>-->
<!--                     {% endif %}-->
<!--                    </div>-->
<!--                 </div>-->
<!--            </div>-->
        <h1 class="ui inverted header"></h1>
    </div>



<!--    comments section end-->
</div>

</div>
</div>
</div>
</div>
</div>

<script>


    // identify images of author which written comments
    profileImageShow = document.querySelectorAll('.profileImageShow')
    profileImageShow.forEach(function(item){
        each_profileImage_id = item.id
        each_profileImage = item.src = "/static/images/" + each_profileImage_id + ".jpg";
    })

    // Identify images of the author to which comments have replied
    profileImageShowReply = document.querySelectorAll('.profileImageShowReply')
    profileImageShowReply.forEach(function(item){
        each_profileImageReply_id = item.id
        each_profileImageReply = item.src = "/static/images/" + each_profileImageReply_id + ".jpg";

    })


</script>

 {% endblock content %}